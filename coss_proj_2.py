# -*- coding: utf-8 -*-
"""ê°œë³„í”„ë¡œì íŠ¸_2(ì†¡ìœ ë¹ˆ).ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1Y-UAYjt7WmE_9kGLvto2rcqYFnigeHXW

# ì£¼ì œ: ë‹¤ì–‘í•œ ë°©ë²•ìœ¼ë¡œ ìˆ™ë°•ì—…ì†Œ ë°ì´í„° ë¶„ì„í•˜ê¸°

## ëª¨ë“ˆ ì„í¬íŠ¸
"""

import pandas as pd
import seaborn as sns
import matplotlib.pyplot as plt
import folium
import plotly.express as px
import streamlit as st
from streamlit_folium import st_folium
import koreanize_matplotlib

st.title("êµ­ë‚´ ìˆ™ë°•ì—… ë°ì´í„° ë¶„ì„í•˜ê¸° ğŸ¡")

"""
### ê¸°íšì˜ë„
- ìµœê·¼ íœ´ê°€ì² ì„ ë§ì•„ ì—¬í–‰ ê³„íšì„ ì•Œì•„ë³´ë˜ ì¤‘, êµ­ë‚´ ìˆ™ë°•ì—…ì†Œ ìœ„ì¹˜ ë¹„ìœ¨/ì½”ë¡œë‚˜19ê°€ ìˆ™ë°•ì—…ê³„ì— ë¯¸ì¹œ ì˜í–¥ ë“± ë‹¤ì–‘í•œ ë°©ë²•ìœ¼ë¡œ ìˆ™ë°•ì—… ë°ì´í„°ë¥¼ ë¶„ì„í•˜ê³  ì‹¶ë‹¤ëŠ” ìƒê°ì´ ë“¤ì–´ í•´ë‹¹ í”„ë¡œì íŠ¸ë¥¼ ì„ ì •í•˜ê²Œ ë˜ì—ˆë‹¤.

### ì´ìš© ë°ì´í„°
- ê³µê³µë°ì´í„° í¬í„¸ì— ìˆëŠ” 'í–‰ì •ì•ˆì „ë¶€_ìˆ™ë°•ì—…' ë°ì´í„° (csv)
- KOSIS êµ­ê°€ í†µê³„ í¬í„¸ì— ìˆëŠ” 'ì§€ì—­ë³„ ë©´ì ' ë°ì´í„° (csv)

### ë°ì´í„° ì „ì²˜ë¦¬
1. ìˆ™ë°•ì—… ë°ì´í„°ì˜ ìœ„ì¹˜ ì¢Œí‘œê°€ ìœ„/ê²½ë„ê°€ ì•„ë‹Œ ì¤‘ë¶€ì›ì  ê¸°ì¤€ ì¢Œí‘œë¡œ ì„¤ì •
-> pyprojì˜ Proj, transform ëª¨ë“ˆì„ ì‚¬ìš©í•˜ì—¬ ë³€í™˜
"""

# %config InlineBackend.figure_format = 'retina'

plt.rc('font', family='NanumGothic')

df = pd.read_csv('fulldata_03_11_03_P_á„‰á…®á†¨á„‡á…¡á†¨á„‹á…¥á†¸.csv', encoding='CP949')
df.head()

from pyproj import Proj, transform

proj_1 = Proj(init='epsg:2097')
proj_2 = Proj(init='epsg:4326')

converted = transform(proj_1, proj_2, df['ì¢Œí‘œì •ë³´(x)'].values, df['ì¢Œí‘œì •ë³´(y)'].values)
df['ì¢Œí‘œì •ë³´(x)'], df['ì¢Œí‘œì •ë³´(y)'] = converted[0], converted[1]
df.rename(columns={'ì¢Œí‘œì •ë³´(x)':'ê²½ë„', 'ì¢Œí‘œì •ë³´(y)':'ìœ„ë„'}, inplace=True)

st.code("""proj_1 = Proj(init='epsg:2097')
proj_2 = Proj(init='epsg:4326')

converted = transform(proj_1, proj_2, df['ì¢Œí‘œì •ë³´(x)'].values, df['ì¢Œí‘œì •ë³´(y)'].values)
df['ì¢Œí‘œì •ë³´(x)'], df['ì¢Œí‘œì •ë³´(y)'] = converted[0], converted[1]
df.rename(columns={'ì¢Œí‘œì •ë³´(x)':'ê²½ë„', 'ì¢Œí‘œì •ë³´(y)':'ìœ„ë„'}, inplace=True)""")

df_new = df[['ë²ˆí˜¸', 'ê°œë°©ì„œë¹„ìŠ¤ëª…', 'ì¸í—ˆê°€ì¼ì', 'íì—…ì¼ì', 'ì†Œì¬ì§€ë©´ì ', 'ì†Œì¬ì§€ì „ì²´ì£¼ì†Œ',
                 'ë„ë¡œëª…ì „ì²´ì£¼ì†Œ', 'ì‚¬ì—…ì¥ëª…', 'ìµœì¢…ìˆ˜ì •ì‹œì ', 'ë°ì´í„°ê°±ì‹ ì¼ì', 'ì—…íƒœêµ¬ë¶„ëª…',
                 'ìœ„ë„', 'ê²½ë„', 'ê±´ë¬¼ì§€ìƒì¸µìˆ˜', 'ê±´ë¬¼ì§€í•˜ì¸µìˆ˜', 'ì‚¬ìš©ì‹œì‘ì§€ìƒì¸µ',
                 'ì‚¬ìš©ëì§€ìƒì¸µ', 'ì‚¬ìš©ì‹œì‘ì§€í•˜ì¸µ', 'ì‚¬ìš©ëì§€í•˜ì¸µ', 'í•œì‹¤ìˆ˜', 'ì–‘ì‹¤ìˆ˜']]

"""2. ì˜ì—…ì¤‘ì¸ ìˆ™ë°•ì—…ì†Œ/íì—… ìƒíƒœì¸ ìˆ™ë°•ì—…ì†Œë¥¼ ê°ê° ë‹¤ë¥¸ ë¶„ì„ì— ì´ìš©í•  ì˜ˆì •ì´ê¸° ë•Œë¬¸ì— ë°ì´í„°ì…‹ì„ ë¶„ë¦¬"""
df_open = df_new.loc[df['ì˜ì—…ìƒíƒœëª…']!='íì—…']
df_close = df_new.loc[df['ì˜ì—…ìƒíƒœëª…']=='íì—…']

st.code("""df_open = df_new.loc[df['ì˜ì—…ìƒíƒœëª…']!='íì—…']
df_close = df_new.loc[df['ì˜ì—…ìƒíƒœëª…']=='íì—…']""")

"""### ê°€ì„¤ ì„¤ì • ë° ë¶„ì„"""

st.write('<strong style="font-size:15pt;">ê°€ì„¤ 1. ì˜ì—…ì¤‘ì¸ ìˆ™ë°•ì—…ì†ŒëŠ” ë¶€ì‚°/ì œì£¼ë„ ë“± ì—¬í–‰ì§€ì— ê°€ì¥ ë§ì´ ë¶„í¬í•  ê²ƒì´ë‹¤.</strong>', unsafe_allow_html=True)
"""- seaborn, folium ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì´ìš©í•œ ì‹œê°í™”"""

"""- ì ˆëŒ€ì ì¸ ê°œìˆ˜ë¡œ ë¶„ì„"""

location = df_open['ì†Œì¬ì§€ì „ì²´ì£¼ì†Œ'].str.split().str[0]

plot1 = plt.figure(figsize=(15,8))
sns.countplot(x=location)
plt.show()

st.pyplot(plot1)

"""- ì§€ì—­ë³„ ë©´ì  ëŒ€ë¹„ ê°œìˆ˜ë¡œ ë¶„ì„"""

"""ì§€ì—­ë³„ ë©´ì  ë°ì´í„°í”„ë ˆì„(area)ê³¼ ìˆ™ë°•ì—…ì†Œ ê°œìˆ˜ ë°ì´í„°í”„ë ˆì„(loc_cnt)ì„ ë³‘í•©ì‹œì¼œ ìƒˆë¡œìš´ í”„ë ˆì„ ìƒì„±"""

area = pd.read_csv('á„Œá…µá„‹á…§á†¨á„‡á…§á†¯_á„†á…§á†«á„Œá…¥á†¨_20230628230940.csv', encoding='CP949')
area = area[['ë‚¨ë¶í•œë³„ ', '2021']][16:]
area.rename(columns={'ë‚¨ë¶í•œë³„ ':'ìœ„ì¹˜', '2021':'ë©´ì '}, inplace=True)
area['ë©´ì '] = area['ë©´ì '].astype(int)

st.code("""loc_cnt_area = pd.merge(area, loc_cnt)
loc_cnt_area.rename(columns={'count':'ê°œìˆ˜'}, inplace=True)

loc_cnt_area['ë©´ì ëŒ€ë¹„ê°œìˆ˜'] = loc_cnt_area['ê°œìˆ˜']/loc_cnt_area['ë©´ì ']
loc_cnt_area.sort_values(by='ë©´ì ëŒ€ë¹„ê°œìˆ˜', ascending=False, inplace=True)""")

loc_cnt = location.value_counts().to_frame()
loc_cnt['ìœ„ì¹˜'] = loc_cnt.index
loc_cnt_area = pd.merge(area, loc_cnt)
loc_cnt_area.rename(columns={'count':'ê°œìˆ˜'}, inplace=True)

loc_cnt_area['ë©´ì ëŒ€ë¹„ê°œìˆ˜'] = loc_cnt_area['ê°œìˆ˜']/loc_cnt_area['ë©´ì ']
loc_cnt_area.sort_values(by='ë©´ì ëŒ€ë¹„ê°œìˆ˜', ascending=False, inplace=True)

plot2 = plt.figure(figsize=(15,8))
sns.barplot(data=loc_cnt_area, x='ìœ„ì¹˜', y='ë©´ì ëŒ€ë¹„ê°œìˆ˜')
st.pyplot(plot2)

"""- ì§€ë„ë¡œ í™•ì¸"""

df_open_loc = df_open[['ìœ„ë„', 'ê²½ë„']].dropna()

from folium.plugins import HeatMap

m = folium.Map(
  location=[35.8053542,127.7043419],
  zoom_start=7
)

heatmap = HeatMap(data=zip(df_open_loc['ìœ„ë„'], df_open_loc['ê²½ë„']), min_opacity=0.2, max_val=7,
                radius=10, blur=1.5, max_zoom=5,color='red')
m.add_child(heatmap)

st_data = st_folium(m, width=725)

"""- ê²°ë¡ : ì ˆëŒ€ì ì¸ ê°’ì€ ê²½ê¸°ë„ì— ê°€ì¥ ë§ìœ¼ë‚˜, ë©´ì  ëŒ€ë¹„ ê°œìˆ˜ì˜ ë¹„ìœ¨ì„ êµ¬í•´ë³´ë©´ ì„œìš¸ì´ ì••ë„ì ìœ¼ë¡œ ë§ë‹¤. ë©´ì ì´ ì‘ì€ ê´‘ì—­ì‹œì˜ ê²½ìš°, ë©´ì  ëŒ€ë¹„ ê°œìˆ˜ë¥¼ êµ¬í–ˆì„ ë•Œ ìƒëŒ€ì ìœ¼ë¡œ í° ê°’ì´ ë‚˜ì˜¤ê¸° ë•Œë¬¸ì— ë†’ì€ ìˆœìœ„ì— ìœ„ì¹˜í•´ìˆë‹¤."""

st.write('<strong style="font-size:15pt;">ê°€ì„¤2. ì½”ë¡œë‚˜19 ì´í›„ë¡œ ìˆ™ë°•ì—…ì²´ì˜ ì—°í‰ê·  íì—…ë¥ ì´ ëŠ˜ì–´ë‚¬ì„ ê²ƒì´ë‹¤.</strong>', unsafe_allow_html=True)
"""- plotly ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì´ìš©í•œ ì‹œê°í™”"""

df_close.head()

closed_year = df_close['íì—…ì¼ì'].str[:4].value_counts()
closed_year = closed_year.sort_index()[10:-1]
closed_year.tail()

closed_year_df = closed_year.to_frame().reset_index()
closed_year_df.rename(columns={'count':'íì—…ìˆ˜', 'íì—…ì¼ì':'ì—°ë„'}, inplace=True)
closed_year_df['ì—°ë„'] = closed_year_df['ì—°ë„'].astype(int)
closed_year_df.head()

"""- ì „ì²´ ì—°ë„ë³„ íì—…ìˆ˜ë¥¼ ì„  ê·¸ë˜í”„ë¡œ ë‚˜íƒ€ë‚´ê¸°"""
st.plotly_chart(px.line(closed_year_df, x='ì—°ë„', y='íì—…ìˆ˜').update_layout(title='ì—°ë„ë³„ íì—…ìˆ˜'))

"""- ì „ì²´ ì—°ë„ë³„ íì—…ìˆ˜ë¥¼ ì‚°ì ë„ë¡œ ë‚˜íƒ€ë‚´ê¸°"""
st.plotly_chart(px.scatter(closed_year_df, x='ì—°ë„', y='íì—…ìˆ˜'))

after_covid = closed_year_df.loc[closed_year_df['ì—°ë„']>=2020]

"""- ì½”ë¡œë‚˜ ì´ì „ ì „ì²´ì‹œê¸°(1986 ~ 2019)ì™€ ì½”ë¡œë‚˜ì‹œê¸°(2020 ~ 2022) ì—°ë„ë³„ íì—…ë¥  ë¹„êµ"""
before_covid = closed_year_df.loc[closed_year_df['ì—°ë„']<2020]

df_covid = pd.DataFrame()
df_covid['ì½”ë¡œë‚˜'] = ['ì´ì „', 'ì´í›„']
df_covid['ì—°í‰ê·  íì—…ìˆ˜'] = [before_covid['íì—…ìˆ˜'].sum()/len(before_covid), after_covid['íì—…ìˆ˜'].sum()/len(after_covid)]
st.plotly_chart(px.histogram(df_covid, x='ì½”ë¡œë‚˜', y='ì—°í‰ê·  íì—…ìˆ˜', color='ì½”ë¡œë‚˜'))

"""- ì½”ë¡œë‚˜ ì´ì „ 3ë…„(2017 ~ 2019)ì™€ ì½”ë¡œë‚˜ì‹œê¸°(2020 ~ 2022) ì—°ë„ë³„ íì—…ë¥  ë¹„êµ"""
before_covid = closed_year_df.loc[closed_year_df['ì—°ë„']<2020][-3:]

df_covid = pd.DataFrame()
df_covid['ì½”ë¡œë‚˜'] = ['ì´ì „', 'ì´í›„']
df_covid['ì—°í‰ê·  íì—…ìˆ˜'] = [before_covid['íì—…ìˆ˜'].sum()/len(before_covid), after_covid['íì—…ìˆ˜'].sum()/len(after_covid)]
st.plotly_chart(px.histogram(df_covid, x='ì½”ë¡œë‚˜', y='ì—°í‰ê·  íì—…ìˆ˜', color='ì½”ë¡œë‚˜'))

"""- ì½”ë¡œë‚˜ ì´ì „ 10ë…„(2010 ~ 2019)ì™€ ì½”ë¡œë‚˜ì‹œê¸°(2020 ~ 2022) ì—°ë„ë³„ íì—…ë¥  ë¹„êµ"""
before_covid = closed_year_df.loc[closed_year_df['ì—°ë„']<2020][-10:]


df_covid = pd.DataFrame()
df_covid['ì½”ë¡œë‚˜'] = ['ì´ì „', 'ì´í›„']
df_covid['ì—°í‰ê·  íì—…ìˆ˜'] = [before_covid['íì—…ìˆ˜'].sum()/len(before_covid), after_covid['íì—…ìˆ˜'].sum()/len(after_covid)]
st.plotly_chart(px.histogram(df_covid, x='ì½”ë¡œë‚˜', y='ì—°í‰ê·  íì—…ìˆ˜', color='ì½”ë¡œë‚˜'))

"""- ê²°ë¡ : ì „ì²´ì ì¸ ê·¸ë˜í”„ë¥¼ ë³¼ ë•ŒëŠ” íŠ¹ì´ì ì´ í¬ê²Œ ë‚˜íƒ€ë‚˜ì§€ ì•Šì•˜ì§€ë§Œ, ì—°í‰ê·  íì—…ë¥ ì„ ë³´ì•˜ì„ ë•ŒëŠ” ì½”ë¡œë‚˜ ì´ì „ì— ë¹„í•´ ì½”ë¡œë‚˜ ì‹œê¸°ë¥¼ ê²ªì€ 2020ë…„ë¶€í„° 2022ë…„ê¹Œì§€ ì•½ 2ë°° ë†’ì€ íì—…ë¥ ì„ ë³´ì˜€ë‹¤. ì´ë¥¼ í†µí•´ ì½”ë¡œë‚˜ê°€ ìˆ™ë°•ì—…ê³„ì˜ íì—…ì— ë¯¸ì¹œ ì˜í–¥ì´ ìˆì„ ê²ƒì´ë¼ê³  íŒë‹¨í–ˆìœ¼ë‚˜, ì½”ë¡œë‚˜ ì´ì „ 3ë…„/10ë…„ ê°„ì˜ ë°ì´í„°ë¥¼ ë¶„ì„í•´ë³´ë‹ˆ í˜„ì¬ ìˆ™ë°•ì—…ê³„ì˜ íì—…ë¥ ì´ ì¦ê°€í•˜ëŠ” ì¶”ì„¸ì˜€ë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆì—ˆë‹¤. ë”°ë¼ì„œ ì½”ë¡œë‚˜19ê°€ ìˆ™ë°•ì—…ê³„ íì—…ì— í° ì˜í–¥ì„ ë¯¸ì³¤ë‹¤ëŠ” ìœ ì˜ë¯¸í•œ ê²°ê³¼ë¥¼ ë°œê²¬í•  ìˆ˜ëŠ” ì—†ì—ˆë‹¤. ê·¸ë¦¬ê³ , 2003ë…„ë„ì— ìœ ë… ë§ì€ ìˆ«ìì˜ ìˆ™ë°•ì—…ì†Œê°€ íì—…í–ˆëŠ”ë°, ë‹¹ì‹œì˜ ì‚¬íšŒì  ìƒí™©ì— ë”°ë¥¸ ì´ìœ ê°€ ìˆì„ ê²ƒì´ë¼ê³  ìƒê°ëœë‹¤."""


